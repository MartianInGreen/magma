<div class="flex flex-col justify-between h-[95%]">
    <div class="flex-1">
        <!-- Icon -->
        <div class="flex justify-start items-center h-10 ml-4 mt-4">
            <h1 class="font-bold text-1xl">Avatar: </h1>
            <div class="avatar h-full ml-4" id="avatar">
                {% if avatarIcon %}
                    <img src="{{ avatarIcon }}" alt="Avatar" class="rounded-full w-full h-full object-cover">
                {% else %}
                    <img src="/images/avatar_small.png" alt="Avatar" class="rounded-full w-full h-full object-cover">    
                {% endif %}
            </div>
            <div class="flex flex-grow"></div>
            <input id="changeAvatar" type="file" class="file-input file-input-bordered w-full max-w-xs mr-4" />
        </div>
        <!-- Username -->
        <div class="flex justify-start items-center h-10 ml-4 mt-4">
            <h1 class="font-bold text-1xl">Username: </h1>
            <div class="flex-grow"></div>
            <input id="userNameInput" type="text" value="{{ userName }}" class="input input-bordered w-full max-w-xs mr-4 ml-4" />
        </div>
        <!-- UserDisplayName -->
        <div class="flex justify-start items-center h-10 ml-4 mt-4">
            <h1 class="font-bold text-1xl">Display Name: </h1>
            <div class="flex-grow"></div>
            <input id="userDisplayName" type="text" value="{{ userDisplayName }}" class="input input-bordered w-full max-w-xs mr-4 ml-4" />
        </div>
        <!-- Email -->
        <div class="flex justify-start items-center h-10 ml-4 mt-4">
            <h1 class="font-bold text-1xl">Email: </h1>
            <div class="flex-grow"></div>
            <input id="userEmail" type="text" value="{{ userEmail }}" class="input input-bordered w-full max-w-xs mr-4 ml-4" />
        </div>

        <div class="h-20"></div>

        <div class="flex justify-center">
            <div tabindex="0" class="collapse collapse-arrow border border-base-300 bg-base-200 mt-4 w-[80%]">
                <input type="checkbox" /> 
                <div class="collapse-title text-xl font-medium">
                    <div class="flex justify-start items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" /></svg>
                                                
                        <h1 class="ml-2 font-bold"> Tokens </h1>
                        <span id="toolLoadingIndicator-{{ toolCallID }}" class="loading loading-dots loading-sm" style="display: none;"></span>
                    </div>
                </div>
                <div class="collapse-content"> 
                    <div class="rounded-box bg-base-100">
                        {{ tokens }}
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div id="emailNotValid" class="flex justify-center items-center" style="display: none;">
        <div role="alert" class="alert alert-error mb-10 w-full w-[80%]">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <span>Error! E-Mail not a valid E-Mail!</span>
        </div>
    </div>
    <div class="flex justify-center items-center h-10 mr-4">
        <button id="update" class="btn btn-primary">Save</button>
    </div>
</div>

<script>
   // User data update
   document.getElementById('update').addEventListener('click', function() {
        var userName = document.getElementById('userNameInput').value;
        var userDisplayName = document.getElementById('userDisplayName').value;
        var userEmail = document.getElementById('userEmail').value;

        fetch('/api/user/updateUser', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                'userName': userName,
                'userDisplayName': userDisplayName,
                'userEmail': userEmail
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data === 401) {
                document.getElementById('emailNotValid').style.display = 'flex';
            } else {
                document.getElementById('emailNotValid').style.display = 'none';
            }
            console.log(data);
        })
        .catch(error => console.error(error));
    });


    document.getElementById('changeAvatar').addEventListener('change', function() {
        var file = this.files[0];
        var formData = new FormData();
        formData.append('avatar', file);

        fetch('/api/user/updateAvatar', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            // Fetch the new avatar URL after successful update
            fetch('/api/user/avatarIcon')
                .then(response => response.json())
                .then(data => {
                    // Update the avatar image source with the new URL
                    document.getElementById('avatar').querySelector('img').src = data.avatarIcon;
                })
                .catch(error => console.error(error));
            })
            .catch(error => console.error(error));
    });
</script>